@use '@/styles/variables' as *;
@use '@/styles/mixins' as *;

.messagesPage {
  display: flex;
  height: calc(100vh - $header-height - $spacing-8);
  background-color: var(--bg-primary);
  border-radius: $radius-lg;
  overflow: hidden;
  border: 1px solid var(--border-default);
}

// Conversations List Panel
.conversationsPanel {
  width: 100%;
  display: flex;
  flex-direction: column;
  background-color: var(--card-bg);
  border-right: 1px solid var(--border-default);
  min-height: 0; // Important for nested flex containers
  overflow: hidden;

  @include md {
    width: 320px;
    min-width: 320px;
  }

  @include lg {
    width: 380px;
    min-width: 380px;
  }
}

.hideOnMobile {
  @include below-md {
    display: none;
  }
}

.panelHeader {
  @include flex-between;
  padding: $spacing-4;
  border-bottom: 1px solid var(--border-default);
}

.panelTitle {
  margin: 0;
  @include heading-4;
}

.newChatButton {
  @include button-primary;
  width: 40px;
  height: 40px;
  padding: 0;
  border-radius: $radius-full;
}

// Search
.searchWrapper {
  position: relative;
  padding: $spacing-3 $spacing-4;
  border-bottom: 1px solid var(--border-default);
}

.searchIcon {
  position: absolute;
  left: $spacing-6;
  top: 50%;
  transform: translateY(-50%);
  color: var(--icon-muted);
  pointer-events: none;
}

.searchInput {
  @include input-base;
  @include input-md;
  padding-left: $spacing-12;
}

// Chat List
.chatList {
  flex: 1;
  overflow-y: auto;
  min-height: 0; // Important for flex overflow
  overscroll-behavior: contain; // Prevent scroll chaining
  @include custom-scrollbar;
}

.chatItem {
  @include flex-start;
  gap: $spacing-3;
  padding: $spacing-3 $spacing-4;
  cursor: pointer;
  position: relative;
  @include transition-colors;

  &:hover {
    background-color: var(--bg-hover);
  }

  &.active {
    background-color: var(--sidebar-item-active);
  }

  &:not(:last-child) {
    border-bottom: 1px solid var(--border-subtle);
  }
}

.chatAvatar {
  @include avatar($avatar-lg);
  flex-shrink: 0;
}

.chatInfo {
  flex: 1;
  min-width: 0;
}

.chatHeader {
  @include flex-between;
  margin-bottom: $spacing-1;
}

.chatName {
  @include subheading-2;
  color: var(--text-primary);
  @include truncate;
}

.chatTime {
  @include caption;
  color: var(--text-muted);
  flex-shrink: 0;
}

.chatPreview {
  @include body-2;
  @include truncate;
  color: var(--text-tertiary);
  margin: 0;
}

.unreadBadge {
  position: absolute;
  top: 50%;
  right: $spacing-4;
  transform: translateY(-50%);
  width: 10px;
  height: 10px;
  background-color: var(--primary);
  border-radius: $radius-full;
}

// Empty State
.emptyState {
  @include flex-column-center;
  gap: $spacing-4;
  padding: $spacing-12 $spacing-6;
  text-align: center;
  color: var(--text-muted);

  svg {
    color: var(--text-muted);
    opacity: 0.4;
  }

  h3 {
    color: var(--text-secondary);
    margin: 0;
    @include heading-5;
  }

  p {
    margin: 0;
    @include body-2;
  }
}

.startChatButton {
  @include button-primary;
  @include button-md;
  margin-top: $spacing-2;
}

// Chat Panel
.chatPanel {
  flex: 1;
  display: none;
  flex-direction: column;
  background-color: var(--bg-secondary);
  overflow: hidden;
  min-height: 0; // Important for nested flex containers

  @include md {
    display: flex;
  }
}

.showOnMobile {
  @include below-md {
    display: flex;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: $z-fixed;
  }
}

.noChatSelected {
  @include flex-column-center;
  flex: 1;
  gap: $spacing-4;
  padding: $spacing-8;
  text-align: center;
  color: var(--text-muted);

  svg {
    color: var(--text-muted);
    opacity: 0.3;
  }

  h2 {
    color: var(--text-secondary);
    margin: 0;
    @include heading-4;
  }

  p {
    margin: 0;
    max-width: 400px;
    @include body-1;
  }
}
